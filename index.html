<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra-Accurate Location Tracker</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
    min-height: 100vh;
    color: white;
  }
  .container { max-width: 1000px; margin: 0 auto; text-align: center; }
  h1 { 
    font-size: 2.8em; margin-bottom: 10px; 
    background: linear-gradient(45deg, #fff, #a8e6cf);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .controls { 
    margin: 30px 0; display: flex; justify-content: center; gap: 15px; 
    flex-wrap: wrap; position: sticky; top: 20px; background: rgba(0,0,0,0.3);
    padding: 15px; border-radius: 20px; backdrop-filter: blur(20px);
  }
  button { 
    background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.4);
    padding: 15px 25px; font-size: 16px; border-radius: 50px; cursor: pointer;
    transition: all 0.3s ease; backdrop-filter: blur(10px);
  }
  button:hover:not(:disabled) { 
    background: rgba(255,255,255,0.3); transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #status { 
    margin: 20px 0; font-size: 1.4em; font-weight: bold; min-height: 50px;
    padding: 20px; border-radius: 15px; backdrop-filter: blur(10px);
  }
  #accuracy-panel {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px; margin: 20px 0; background: rgba(0,0,0,0.4);
    padding: 20px; border-radius: 15px;
  }
  .accuracy-metric {
    background: rgba(255,255,255,0.1); padding: 15px;
    border-radius: 10px; text-align: center;
  }
  .accuracy-meter {
    width: 100%; height: 20px; background: rgba(0,0,0,0.5);
    border-radius: 10px; overflow: hidden; margin-top: 10px;
  }
  .accuracy-fill {
    height: 100%; transition: width 0.5s ease; border-radius: 10px;
  }
  .excellent { background: linear-gradient(90deg, #51cf66, #40c057); }
  .good { background: linear-gradient(90deg, #ffd43b, #fab005); }
  .fair { background: linear-gradient(90deg, #ff9ff3, #f368e0); }
  .poor { background: linear-gradient(90deg, #ff6b6b, #ee5a52); }
  #map {
    height: 600px; margin-top: 20px; border-radius: 20px;
    border: 4px solid rgba(255,255,255,0.2); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>
<div class="container">
  <h1>üéØ Ultra-Accurate GPS Tracker</h1>
  <div class="controls">
    <button id="highAccuracyBtn">üöÄ High Accuracy Mode</button>
    <button id="trackBtn">‚ñ∂Ô∏è Continuous Tracking</button>
    <button id="stopBtn" disabled>‚èπÔ∏è Stop</button>
    <button id="calibrateBtn">‚öôÔ∏è Calibrate GPS</button>
  </div>
  
  <div id="status">Ready for ultra-accurate positioning</div>
  
  <div id="accuracy-panel">
    <div class="accuracy-metric">
      <div>GPS Accuracy</div>
      <div id="gpsAccuracy" class="accuracy-meter"><div id="gpsFill" class="accuracy-fill"></div></div>
      <div id="gpsValue">-- m</div>
    </div>
    <div class="accuracy-metric">
      <div>Signal Quality</div>
      <div id="signalQuality" class="accuracy-meter"><div id="signalFill" class="accuracy-fill"></div></div>
      <div id="signalValue">--</div>
    </div>
    <div class="accuracy-metric">
      <div>Satellites</div>
      <div id="satellites">--</div>
    </div>
    <div class="accuracy-metric">
      <div>Speed</div>
      <div id="speed">-- km/h</div>
    </div>
  </div>
  
  <div id="coords"></div>
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const status = document.getElementById('status');
  const coords = document.getElementById('coords');
  const highAccuracyBtn = document.getElementById('highAccuracyBtn');
  const trackBtn = document.getElementById('trackBtn');
  const stopBtn = document.getElementById('stopBtn');
  const calibrateBtn = document.getElementById('calibrateBtn');
  
  let map, marker, watchId;
  let currentPosition = { lat: 0, lng: 0, accuracy: 9999, speed: 0, satellites: 0 };

  // Accuracy visualization functions
  function updateAccuracyMeter(elementId, value, max = 100, className) {
    const fill = document.getElementById(elementId);
    const percent = Math.max(0, Math.min(100, (value / max) * 100));
    fill.style.width = percent + '%';
    fill.className = `accuracy-fill ${className}`;
  }

  function getAccuracyClass(accuracy) {
    if (accuracy < 10) return 'excellent';
    if (accuracy < 30) return 'good';
    if (accuracy < 100) return 'fair';
    return 'poor';
  }

  function initMap(lat, lng) {
    map = L.map('map').setView([lat, lng], 18);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 22, attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    // Ultra-precise marker
    marker = L.circleMarker([lat, lng], {
      radius: 8,
      fillColor: '#40c057',
      color: '#36d973',
      weight: 3,
      opacity: 1,
      fillOpacity: 0.8
    }).addTo(map).bindPopup('üéØ Ultra-Accurate GPS');
  }

  function updateLocation(position) {
    const { latitude, longitude, accuracy, speed, altitudeAccuracy, heading } = position.coords;
    
    currentPosition = { lat: latitude, lng: longitude, accuracy, speed: speed || 0 };
    
    // Smooth camera movement
    map.setView([latitude, longitude], 18, { animate: true, duration: 1 });
    
    // Update precise marker
    marker.setLatLng([latitude, longitude]);
    marker.setRadius(Math.max(5, 15 - accuracy / 10));
    marker.setStyle({
      fillColor: accuracy < 20 ? '#40c057' : accuracy < 50 ? '#ffd43b' : '#ff6b6b',
      color: accuracy < 20 ? '#36d973' : accuracy < 50 ? '#fab005' : '#ee5a52'
    });
    
    // Real-time accuracy dashboard
    const accuracyClass = getAccuracyClass(accuracy);
    updateAccuracyMeter('gpsFill', 1000 - accuracy, 1000, accuracyClass);
    document.getElementById('gpsValue').textContent = accuracy < 1 ? '<1 m' : `${accuracy.toFixed(1)} m`;
    
    updateAccuracyMeter('signalFill', accuracy < 20 ? 100 : accuracy < 50 ? 70 : 30, 100, accuracyClass);
    document.getElementById('signalValue').textContent = accuracy < 20 ? 'EXCELLENT' : 
      accuracy < 50 ? 'GOOD' : accuracy < 100 ? 'FAIR' : 'POOR';
    
    document.getElementById('speed').textContent = speed ? `${(speed * 3.6).toFixed(1)} km/h` : '-- km/h';
    
    // Live coordinates
    coords.innerHTML = `
      <div style="font-size: 1.3em; margin: 20px 0;">
        <strong>üéØ Precise GPS Coordinates:</strong><br><br>
        <span style="font-family: monospace; font-size: 1.4em;">
          üìç ${latitude.toFixed(8)}¬∞ N, ${longitude.toFixed(8)}¬∞ E
        </span><br><br>
        <span style="color: ${accuracy < 20 ? '#40c057' : '#ff6b6b'}; font-weight: bold;">
          üìè ${accuracy < 1 ? '<1m' : accuracy.toFixed(1) + 'm'} precision
        </span>
      </div>
    `;
    
    status.textContent = `‚úÖ GPS Locked: ${accuracy < 5 ? 'Surgical' : accuracy < 20 ? 'Excellent' : 
      accuracy < 50 ? 'Very Good' : 'Good'} (${accuracy.toFixed(1)}m)`;
  }

  // ULTRA-ACCURATE Geolocation with maximum settings [web:58]
  function getUltraAccurateLocation(oneTime = false) {
    if (!navigator.geolocation) {
      status.textContent = '‚ùå Geolocation not supported'; return;
    }

    const options = {
      enableHighAccuracy: true,        // CRITICAL for GPS accuracy [web:58]
      timeout: 15000,                  // Longer timeout for better fix
      maximumAge: 1000                 // Use recent cache only if <1s old
    };

    showStatus(oneTime ? 'üöÄ Acquiring high-precision GPS...' : '‚ñ∂Ô∏è Ultra-accurate tracking active');

    if (oneTime) {
      navigator.geolocation.getCurrentPosition(
        updateLocation,
        (error) => {
          const messages = {
            1: 'üö´ GPS permission denied',
            2: 'üì° No GPS signal - go outdoors',
            3: '‚è∞ GPS timeout - retrying calibration'
          };
          showStatus(messages[error.code] || '‚ùå GPS error', true);
        },
        options
      );
    } else {
      // Continuous high-accuracy tracking
      watchId = navigator.geolocation.watchPosition(
        updateLocation,
        (error) => showStatus('üì° Signal lost - recalibrating...', true),
        options
      );
    }
  }

  function showStatus(message, isError = false) {
    status.textContent = message;
    status.style.background = isError ? 'rgba(255,107,107,0.4)' : 'rgba(64,192,115,0.4)';
    status.style.border = isError ? '3px solid #ff6b6b' : '3px solid #40c057';
  }

  // GPS Calibration sequence for maximum accuracy
  function calibrateGPS() {
    showStatus('‚öôÔ∏è Calibrating GPS - stay still outdoors...');
    let calibrationCount = 0;
    const maxSamples = 5;
    
    const calibrate = () => {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          calibrationCount++;
          if (calibrationCount >= maxSamples) {
            showStatus('‚úÖ Calibration complete - ultra-accurate mode ready');
            updateLocation(position);
            if (!map) initMap(position.coords.latitude, position.coords.longitude);
          } else {
            showStatus(`‚öôÔ∏è Calibration ${calibrationCount}/${maxSamples} - stay still...`);
            setTimeout(calibrate, 1000);
          }
        },
        () => showStatus('‚ùå Calibration failed - check GPS settings', true),
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    };
    calibrate();
  }

  // Event listeners
  highAccuracyBtn.addEventListener('click', () => getUltraAccurateLocation(true));
  trackBtn.addEventListener('click', () => {
    trackBtn.disabled = stopBtn.disabled = false;
    highAccuracyBtn.disabled = true;
    getUltraAccurateLocation(false);
  });
  stopBtn.addEventListener('click', () => {
    if (watchId) navigator.geolocation.clearWatch(watchId);
    watchId = null;
    trackBtn.disabled = highAccuracyBtn.disabled = false;
    stopBtn.disabled = true;
    showStatus('‚èπÔ∏è Tracking stopped');
  });
  calibrateBtn.addEventListener('click', calibrateGPS);

  // Auto-start calibration on load
  setTimeout(calibrateGPS, 1000);
</script>
</body>
</html>
    width: 100%; height: 20px; background: rgba(0,0,0,0.5);
    border-radius: 10px; overflow: hidden; margin-top: 10px;
  }
  .accuracy-fill {
    height: 100%; transition: width 0.5s ease; border-radius: 10px;
  }
  .excellent { background: linear-gradient(90deg, #51cf66, #40c057); }
  .good { background: linear-gradient(90deg, #ffd43b, #fab005); }
  .fair { background: linear-gradient(90deg, #ff9ff3, #f368e0); }
  .poor { background: linear-gradient(90deg, #ff6b6b, #ee5a52); }
  #map {
    height: 600px; margin-top: 20px; border-radius: 20px;
    border: 4px solid rgba(255,255,255,0.2); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
  }
</style>
</head>
<body>
<div class="container">
  <h1>üéØ Ultra-Accurate GPS Tracker</h1>
  <div class="controls">
    <button id="highAccuracyBtn">üöÄ High Accuracy Mode</button>
    <button id="trackBtn">‚ñ∂Ô∏è Continuous Tracking</button>
    <button id="stopBtn" disabled>‚èπÔ∏è Stop</button>
    <button id="calibrateBtn">‚öôÔ∏è Calibrate GPS</button>
  </div>
  
  <div id="status">Ready for ultra-accurate positioning</div>
  
  <div id="accuracy-panel">
    <div class="accuracy-metric">
      <div>GPS Accuracy</div>
      <div id="gpsAccuracy" class="accuracy-meter"><div id="gpsFill" class="accuracy-fill"></div></div>
      <div id="gpsValue">-- m</div>
    </div>
    <div class="accuracy-metric">
      <div>Signal Quality</div>
      <div id="signalQuality" class="accuracy-meter"><div id="signalFill" class="accuracy-fill"></div></div>
      <div id="signalValue">--</div>
    </div>
    <div class="accuracy-metric">
      <div>Satellites</div>
      <div id="satellites">--</div>
    </div>
    <div class="accuracy-metric">
      <div>Speed</div>
      <div id="speed">-- km/h</div>
    </div>
  </div>
  
  <div id="coords"></div>
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const status = document.getElementById('status');
  const coords = document.getElementById('coords');
  const highAccuracyBtn = document.getElementById('highAccuracyBtn');
  const trackBtn = document.getElementById('trackBtn');
  const stopBtn = document.getElementById('stopBtn');
  const calibrateBtn = document.getElementById('calibrateBtn');
  
  let map, marker, watchId;
  let currentPosition = { lat: 0, lng: 0, accuracy: 9999, speed: 0, satellites: 0 };

  // Accuracy visualization functions
  function updateAccuracyMeter(elementId, value, max = 100, className) {
    const fill = document.getElementById(elementId);
    const percent = Math.max(0, Math.min(100, (value / max) * 100));
    fill.style.width = percent + '%';
    fill.className = `accuracy-fill ${className}`;
  }

  function getAccuracyClass(accuracy) {
    if (accuracy < 10) return 'excellent';
    if (accuracy < 30) return 'good';
    if (accuracy < 100) return 'fair';
    return 'poor';
  }

  function initMap(lat, lng) {
    map = L.map('map').setView([lat, lng], 18);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 22, attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);
    
    // Ultra-precise marker
    marker = L.circleMarker([lat, lng], {
      radius: 8,
      fillColor: '#40c057',
      color: '#36d973',
      weight: 3,
      opacity: 1,
      fillOpacity: 0.8
    }).addTo(map).bindPopup('üéØ Ultra-Accurate GPS');
  }

  function updateLocation(position) {
    const { latitude, longitude, accuracy, speed, altitudeAccuracy, heading } = position.coords;
    
    currentPosition = { lat: latitude, lng: longitude, accuracy, speed: speed || 0 };
    
    // Smooth camera movement
    map.setView([latitude, longitude], 18, { animate: true, duration: 1 });
    
    // Update precise marker
    marker.setLatLng([latitude, longitude]);
    marker.setRadius(Math.max(5, 15 - accuracy / 10));
    marker.setStyle({
      fillColor: accuracy < 20 ? '#40c057' : accuracy < 50 ? '#ffd43b' : '#ff6b6b',
      color: accuracy < 20 ? '#36d973' : accuracy < 50 ? '#fab005' : '#ee5a52'
    });
    
    // Real-time accuracy dashboard
    const accuracyClass = getAccuracyClass(accuracy);
    updateAccuracyMeter('gpsFill', 1000 - accuracy, 1000, accuracyClass);
    document.getElementById('gpsValue').textContent = accuracy < 1 ? '<1 m' : `${accuracy.toFixed(1)} m`;
    
    updateAccuracyMeter('signalFill', accuracy < 20 ? 100 : accuracy < 50 ? 70 : 30, 100, accuracyClass);
    document.getElementById('signalValue').textContent = accuracy < 20 ? 'EXCELLENT' : 
      accuracy < 50 ? 'GOOD' : accuracy < 100 ? 'FAIR' : 'POOR';
    
    document.getElementById('speed').textContent = speed ? `${(speed * 3.6).toFixed(1)} km/h` : '-- km/h';
    
    // Live coordinates
    coords.innerHTML = `
      <div style="font-size: 1.3em; margin: 20px 0;">
        <strong>üéØ Precise GPS Coordinates:</strong><br><br>
        <span style="font-family: monospace; font-size: 1.4em;">
          üìç ${latitude.toFixed(8)}¬∞ N, ${longitude.toFixed(8)}¬∞ E
        </span><br><br>
        <span style="color: ${accuracy < 20 ? '#40c057' : '#ff6b6b'}; font-weight: bold;">
          üìè ${accuracy < 1 ? '<1m' : accuracy.toFixed(1) + 'm'} precision
        </span>
      </div>
    `;
    
    status.textContent = `‚úÖ GPS Locked: ${accuracy < 5 ? 'Surgical' : accuracy < 20 ? 'Excellent' : 
      accuracy < 50 ? 'Very Good' : 'Good'} (${accuracy.toFixed(1)}m)`;
  }

  // ULTRA-ACCURATE Geolocation with maximum settings [web:58]
  function getUltraAccurateLocation(oneTime = false) {
    if (!navigator.geolocation) {
      status.textContent = '‚ùå Geolocation not supported'; return;
    }

    const options = {
      enableHighAccuracy: true,        // CRITICAL for GPS accuracy [web:58]
      timeout: 15000,                  // Longer timeout for better fix
      maximumAge: 1000                 // Use recent cache only if <1s old
    };

    showStatus(oneTime ? 'üöÄ Acquiring high-precision GPS...' : '‚ñ∂Ô∏è Ultra-accurate tracking active');

    if (oneTime) {
      navigator.geolocation.getCurrentPosition(
        updateLocation,
        (error) => {
          const messages = {
            1: 'üö´ GPS permission denied',
            2: 'üì° No GPS signal - go outdoors',
            3: '‚è∞ GPS timeout - retrying calibration'
          };
          showStatus(messages[error.code] || '‚ùå GPS error', true);
        },
        options
      );
    } else {
      // Continuous high-accuracy tracking
      watchId = navigator.geolocation.watchPosition(
        updateLocation,
        (error) => showStatus('üì° Signal lost - recalibrating...', true),
        options
      );
    }
  }

  function showStatus(message, isError = false) {
    status.textContent = message;
    status.style.background = isError ? 'rgba(255,107,107,0.4)' : 'rgba(64,192,115,0.4)';
    status.style.border = isError ? '3px solid #ff6b6b' : '3px solid #40c057';
  }

  // GPS Calibration sequence for maximum accuracy
  function calibrateGPS() {
    showStatus('‚öôÔ∏è Calibrating GPS - stay still outdoors...');
    let calibrationCount = 0;
    const maxSamples = 5;
    
    const calibrate = () => {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          calibrationCount++;
          if (calibrationCount >= maxSamples) {
            showStatus('‚úÖ Calibration complete - ultra-accurate mode ready');
            updateLocation(position);
            if (!map) initMap(position.coords.latitude, position.coords.longitude);
          } else {
            showStatus(`‚öôÔ∏è Calibration ${calibrationCount}/${maxSamples} - stay still...`);
            setTimeout(calibrate, 1000);
          }
        },
        () => showStatus('‚ùå Calibration failed - check GPS settings', true),
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    };
    calibrate();
  }

  // Event listeners
  highAccuracyBtn.addEventListener('click', () => getUltraAccurateLocation(true));
  trackBtn.addEventListener('click', () => {
    trackBtn.disabled = stopBtn.disabled = false;
    highAccuracyBtn.disabled = true;
    getUltraAccurateLocation(false);
  });
  stopBtn.addEventListener('click', () => {
    if (watchId) navigator.geolocation.clearWatch(watchId);
    watchId = null;
    trackBtn.disabled = highAccuracyBtn.disabled = false;
    stopBtn.disabled = true;
    showStatus('‚èπÔ∏è Tracking stopped');
  });
  calibrateBtn.addEventListener('click', calibrateGPS);

  // Auto-start calibration on load
  setTimeout(calibrateGPS, 1000);
</script>
</body>
</html>
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #status { 
    margin: 20px 0; font-size: 1.4em; font-weight: bold; min-height: 50px;
    padding: 20px; border-radius: 15px; backdrop-filter: blur(10px);
  }
  #accuracy-panel {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px; margin: 20px 0; background: rgba(0,0,0,0.4);
    padding: 20px; border-radius: 15px;
  }
  .accuracy-metric {
    background: rgba(255,255,255,0.1); padding: 15px;
    border-radius: 10px; text-align: center;
  }
  .accuracy-meter {
    width: 100%; height: 20px; background: rgba(0,0,0,0.5);
    border-radius: 10px; overflow: hidden; margin-top: 10px;
  }
  .accuracy-fill {
    height
  button {
    background: rgba(255,255,255,0.2);
    color: white;
    border: 2px solid rgba(255,255,255,0.3);
    padding: 15px 25px;
    font-size: 16px;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
  }
  button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
  }
  button:hover::before {
    left: 100%;
  }
  button:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  #status {
    margin: 20px 0;
    font-size: 1.3em;
    font-weight: bold;
    min-height: 40px;
    padding: 15px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
  }
  #coords {
    background: rgba(0,0,0,0.3);
    padding: 20px;
    border-radius: 15px;
    margin: 20px 0;
    font-family: 'Courier New', monospace;
    border: 1px solid rgba(255,255,255,0.2);
  }
  #map {
    height: 550px;
    margin-top: 20px;
    border-radius: 20px;
    border: 4px solid rgba(255,255,255,0.2);
    box-shadow: 0 15px 40px rgba(0,0,0,0.4);
    position: relative;
    overflow: hidden;
  }
  .map-theme {
    transition: all 0.5s ease;
  }
  #themeToggle {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 1000;
  }
</style>
</head>
<body>
<div class="container">
  <h1>üåç ignatius Location Tracker</h1>
  <div class="controls">
    <button id="detectBtn">üîç Detect Location</button>
    <button id="trackBtn">‚ñ∂Ô∏è Start Tracking</button>
    <button id="stopBtn" disabled>‚èπÔ∏è Stop Tracking</button>
    <button id="themeToggle">üåô Dark Theme</button>
  </div>
  <div id="status">Ready to track your location!</div>
  <div id="coords"></div>
  <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const status = document.getElementById('status');
  const coords = document.getElementById('coords');
  const detectBtn = document.getElementById('detectBtn');
  const trackBtn = document.getElementById('trackBtn');
  const stopBtn = document.getElementById('stopBtn');
  const themeToggle = document.getElementById('themeToggle');
  
  let map, marker, watchId, isDarkTheme = false;
  let isTracking = false;

  // Custom marker icon with JS styling
  const createCustomMarker = (lat, lng) => {
    const pulseIcon = L.divIcon({
      className: 'custom-marker',
      html: `
        <div style="
          width: 40px; height: 40px; 
          background: ${isDarkTheme ? '#ff6b6b' : '#4ecdc4'};
          border-radius: 50%; 
          border: 4px solid ${isDarkTheme ? '#ff4757' : '#45b7d1'};
          box-shadow: 0 0 20px ${isDarkTheme ? '#ff6b6b' : '#4ecdc4'};
          animation: pulse 2s infinite;
          position: relative;
        ">
          <div style="
            width: 12px; height: 12px; 
            background: white; 
            border-radius: 50%; 
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
          "></div>
        </div>
      `,
      iconSize: [40, 40],
      iconAnchor: [20, 20]
    });

    return L.marker([lat, lng], { icon: pulseIcon });
  };

  // Map style configurations
  const mapStyles = {
    light: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    dark: 'https://cartodb-basemaps-c.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png',
    satellite: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
  };

  function initMap(lat, lng) {
    map = L.map('map', {
      zoomControl: true,
      attributionControl: true,
      zoomAnimation: true,
      fadeAnimation: true,
      markerZoomAnimation: true
    }).setView([lat, lng], 16);

    // Load initial map style
    loadMapStyle(mapStyles.light);
    
    // Custom map controls styling
    map.zoomControl.setPosition('topright');
    
    // Add custom marker
    marker = createCustomMarker(lat, lng);
    marker.addTo(map).bindPopup(`
      <div style="text-align: center; font-weight: bold;">
        <b>üìç You Are Here</b><br>
        <small>Live GPS Position</small>
      </div>
    `).openPopup();
  }

  function loadMapStyle(styleUrl) {
    if (map) {
      map.eachLayer(layer => {
        if (layer instanceof L.TileLayer) {
          map.removeLayer(layer);
        }
      });
      
      L.tileLayer(styleUrl, {
        maxZoom: 19,
        attribution: isDarkTheme 
          ? '¬© CartoDB | ¬© OpenStreetMap contributors' 
          : '¬© OpenStreetMap contributors'
      }).addTo(map);
    }
  }

  function updateLocation(lat, lng, accuracy) {
    // Animate marker update
    marker.setLatLng([lat, lng], { animate: true });
    map.flyTo([lat, lng], 16, { duration: 1.5 });
    
    // Update coords with animation
    coords.style.transform = 'scale(1.05)';
    coords.innerHTML = `
      <strong>üìç Live GPS Position:</strong><br>
      <span style="font-size: 1.2em;">Lat: ${lat.toFixed(6)}¬∞</span><br>
      <span style="font-size: 1.2em;">Lng: ${lng.toFixed(6)}¬∞</span><br>
      <span style="color: ${accuracy < 20 ? '#51cf66' : '#ff6b6b'}">
        üìè Accuracy: ${accuracy.toFixed(0)}m ${accuracy < 20 ? '‚úÖ Excellent' : '‚ö†Ô∏è Fair'}
      </span>
    `;
    setTimeout(() => coords.style.transform = 'scale(1)', 200);
  }

  function showStatus(message, isError = false) {
    status.textContent = message;
    status.style.background = isError 
      ? 'rgba(255, 107, 107, 0.3)' 
      : 'rgba(81, 207, 102, 0.3)';
    status.style.border = isError 
      ? '2px solid #ff6b6b' 
      : '2px solid #51cf66';
  }

  function getLocation(oneTime = true) {
    if (!navigator.geolocation) {
      showStatus('‚ùå Geolocation not supported', true);
      return;
    }

    showStatus('üîç Detecting GPS location...');

    if (oneTime) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude, accuracy } = position.coords;
          showStatus('‚úÖ Location locked!');
          updateLocation(latitude, longitude, accuracy);
          if (!map) initMap(latitude, longitude);
        },
        (error) => {
          const messages = {
            1: 'üö´ Location access denied',
            2: 'üì° GPS signal unavailable', 
            3: '‚è∞ Location timeout'
          };
          showStatus(messages[error.code] || '‚ùå Location error', true);
        },
        { timeout: 10000, enableHighAccuracy: true, maximumAge: 30000 }
      );
    } else {
      watchId = navigator.geolocation.watchPosition(
        (position) => updateLocation(position.coords.latitude, position.coords.longitude, position.coords.accuracy),
        (error) => showStatus('Tracking lost signal', true),
        { timeout: 5000, enableHighAccuracy: true }
      );
    }
  }

  // Event listeners
  detectBtn.addEventListener('click', () => getLocation(true));
  
  trackBtn.addEventListener('click', () => {
    isTracking = true;
    trackBtn.disabled = true;
    stopBtn.disabled = false;
    showStatus('‚ñ∂Ô∏è Real-time tracking active');
    getLocation(false);
  });
  
  stopBtn.addEventListener('click', () => {
    if (watchId) navigator.geolocation.clearWatch(watchId);
    isTracking = false;
    trackBtn.disabled = false;
    stopBtn.disabled = true;
    showStatus('‚èπÔ∏è Tracking stopped');
  });

  themeToggle.addEventListener('click', () => {
    isDarkTheme = !isDarkTheme;
    themeToggle.textContent = isDarkTheme ? '‚òÄÔ∏è Light Theme' : 'üåô Dark Theme';
    
    // Recreate marker with new theme
    if (marker) {
      map.removeLayer(marker);
      const currentCenter = map.getCenter();
      marker = createCustomMarker(currentCenter.lat, currentCenter.lng);
      marker.addTo(map);
    }
    
    // Switch map style
    const style = isDarkTheme ? mapStyles.dark : mapStyles.light;
    loadMapStyle(style);
    showStatus(isDarkTheme ? 'üåô Dark theme activated' : '‚òÄÔ∏è Light theme activated');
  });

  // Add pulse animation CSS via JS
  const style = document.createElement('style');
  style.textContent = `
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); }
      70% { box-shadow: 0 0 0 20px rgba(255,255,255,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
    }
  `;
  document.head.appendChild(style);
</script>
</body>
</html>
<button id="locateBtn">Detect My Location</button>
<div id="status"></div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const status = document.getElementById('status');
  const locateBtn = document.getElementById('locateBtn');
  let map, marker;

  function initMap(lat, lng) {
    // Initialize map centered on user's location
    map = L.map('map').setView([lat, lng], 13);

    // Use OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // Add a marker for user's location
    marker = L.marker([lat, lng]).addTo(map).bindPopup('You are here').openPopup();
  }

  function updateMarker(lat, lng) {
    marker.setLatLng([lat, lng]);
    map.setView([lat, lng], map.getZoom());
  }

  function getLocation() {
    if (!navigator.geolocation) {
      status.textContent = 'Geolocation is not supported by your browser.';
      return;
    }
    status.textContent = 'Locating‚Ä¶';

    navigator.geolocation.getCurrentPosition(
      (position) => {
        const { latitude, longitude } = position.coords;
        status.textContent = `Latitude: ${latitude.toFixed(5)}, Longitude: ${longitude.toFixed(5)}`;
        if (!map) {
          initMap(latitude, longitude);
        } else {
          updateMarker(latitude, longitude);
        }
      },
      () => {
        status.textContent = 'Unable to retrieve your location.';
      }
    );
  }

  locateBtn.addEventListener('click', getLocation);
</script>
</body>
</html>
